<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lecci√≥n - Aprende Aviaci√≥n</title>
  <link rel="stylesheet" href="estilos.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
  <header class="barra-superior">
    <h1>‚úàÔ∏è Lecci√≥n</h1>
    <button onclick="window.location.href='niveles.html'" class="btn-secundario">‚Üê Volver</button>
  </header>

  <main class="contenido fade-in">
  <!-- Pantalla de introducci√≥n antes del quiz -->
<div id="introLeccion">
  <h2 id="tituloLeccion">Cargando lecci√≥n...</h2>
  <p id="descripcionLeccion">Explora el contenido de esta lecci√≥n antes de comenzar el desaf√≠o.</p>

  <div id="contenidoLeccion" class="contenido-leccion">
    <!-- Aqu√≠ se insertar√° autom√°ticamente la informaci√≥n educativa -->
  </div>

  <button id="btnComenzar" class="btn-principal">Comenzar lecci√≥n üöÄ</button>

  <button id="btnNarrar" class="btn-narrar">üéß Escuchar resumen</button>

</div>

  <!--ontenedor de preguntas (oculto hasta que se pulse comenzar) -->
  <div id="contenedorPreguntas" style="display:none;"></div>

  <button id="btnSiguiente" class="btn-principal" style="display:none;">Siguiente pregunta ‚ûú</button>
</main>

  <script>
  const contenedorPreguntas = document.getElementById('contenedorPreguntas');
  const btnSiguiente = document.getElementById('btnSiguiente');
  const tituloLeccion = document.getElementById('tituloLeccion');
  const introLeccion = document.getElementById('introLeccion');
  const btnComenzar = document.getElementById('btnComenzar');

  let preguntas = [];
  let indiceActual = 0;
  let puntaje = 0;

  // üîπ Capturar el tema desde la URL
  const urlParams = new URLSearchParams(window.location.search);
  const tema = urlParams.get("tema");

  // üîπ Informaci√≥n de cada lecci√≥n
  const temasInfo = {
  partes_del_avion: {
    nombre: "Partes del avi√≥n ",
    descripcion: "Aprende las partes esenciales de una aeronave: fuselaje, alas, tim√≥n, alerones y tren de aterrizaje.",
    contenido: `
      <ul class="lista-leccion">
        <li><strong>Fuselaje:</strong> Es el cuerpo principal del avi√≥n donde se ubican los pasajeros y la carga.</li>
        <li><strong>Alas:</strong> Generan la sustentaci√≥n necesaria para volar.</li>
        <li><strong>Tim√≥n de direcci√≥n:</strong> Controla el movimiento lateral (gui√±ada).</li>
        <li><strong>Alerones:</strong> Permiten el movimiento de alabeo o inclinaci√≥n lateral.</li>
        <li><strong>Tren de aterrizaje:</strong> Soporta la aeronave en el suelo durante el despegue y el aterrizaje.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/443kjg5uy/Air%60plne-Photoroom.png" alt="Partes del avi√≥n" class="img-leccion"style="max-width:50%;">
    `
  },
  aerodinamica: {
    nombre: "Aerodin√°mica b√°sica ",
    descripcion: "Descubre las cuatro fuerzas del vuelo: sustentaci√≥n, peso, empuje y resistencia.",
    contenido: `
      <p>La aerodin√°mica estudia c√≥mo el aire interact√∫a con el avi√≥n en vuelo. Existen <strong>cuatro fuerzas fundamentales</strong>:</p>
      <ul class="lista-leccion">
        <li>‚úàÔ∏è <strong>Sustentaci√≥n:</strong> fuerza hacia arriba generada por las alas.</li>
        <li>‚¨áÔ∏è <strong>Peso:</strong> fuerza hacia abajo debido a la gravedad.</li>
        <li>‚û°Ô∏è <strong>Empuje:</strong> producido por los motores o h√©lices.</li>
        <li>‚¨ÖÔ∏è <strong>Resistencia:</strong> oposici√≥n del aire al avance.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/443kjg5uy/image%20212.png" alt="Fuerzas del vuelo" class="img-leccion"style="max-width:50%;">
    `
  },
  ingles_aeronautico: {
    nombre: "Ingl√©s aeron√°utico ",
    descripcion: "Domina las frases m√°s comunes utilizadas entre pilotos y controladores a√©reos.",
    contenido: `
      <p>El ingl√©s aeron√°utico es el idioma est√°ndar de comunicaci√≥n a√©rea. Algunas expresiones b√°sicas son:</p>
      <ul class="lista-leccion">
        <li><strong>Cleared for takeoff:</strong> Autorizado para despegar.</li>
        <li><strong>Roger:</strong> Mensaje recibido.</li>
        <li><strong>Stand by:</strong> Espere un momento.</li>
        <li><strong>Mayday:</strong> Emergencia grave.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/443kjg5uy/Language.png" alt="Comunicaci√≥n piloto-control" class="img-leccion"style="max-width:50%;">
    `
  },
  meteorologia: {
    nombre: "Meteorolog√≠a aeron√°utica ",
    descripcion: "Comprende c√≥mo el clima afecta el vuelo: tipos de nubes, presi√≥n y velocidad del viento.",
    contenido: `
      <p>El conocimiento del clima es vital para la seguridad a√©rea. Algunos conceptos b√°sicos:</p>
      <ul class="lista-leccion">
        <li><strong>Cumulonimbo:</strong> nubes de tormenta el√©ctrica.</li>
        <li><strong>Presi√≥n atmosf√©rica:</strong> influye en la lectura del alt√≠metro.</li>
        <li><strong>Viento cruzado:</strong> afecta el control en despegue y aterrizaje.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/4446qs85e/687df8854514c.r_d.972-489-2339%20(1).png" alt="Cumulonimbos" class="img-leccion"style="max-width:50%;">
    `
  },
  instrumentos_de_vuelo: {
    nombre: "Instrumentos de vuelo ",
    descripcion: "Conoce los instrumentos clave de cabina: alt√≠metro, horizonte artificial, anem√≥metro y br√∫jula.",
    contenido: `
      <ul class="lista-leccion">
        <li><strong>Alt√≠metro:</strong> Indica la altitud respecto al nivel del mar.</li>
        <li><strong>Anem√≥metro:</strong> Mide la velocidad del aire.</li>
        <li><strong>Horizonte artificial:</strong> Muestra la actitud del avi√≥n.</li>
        <li><strong>Br√∫jula:</strong> Indica la direcci√≥n o rumbo magn√©tico.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/4446qs85e/instrumentos-vuelo.png" alt="Instrumentos b√°sicos" class="img-leccion"style="max-width:50%;">
    `
  },
  reglamentos: {
    nombre: "Reglamentos aeron√°uticos ",
    descripcion: "Conoce las normas que regulan la aviaci√≥n civil a nivel nacional e internacional.",
    contenido: `
      <p>Las regulaciones garantizan la seguridad de las operaciones a√©reas. Est√°n establecidas por organismos nacionales e internacionales.</p>
      <ul class="lista-leccion">
        <li><strong>OACI:</strong> Organismo internacional que dicta las normas de aviaci√≥n civil.</li>
        <li><strong>Aerocivil:</strong> Autoridad que regula la aviaci√≥n civil en Colombia.</li>
        <li><strong>Licencia de piloto:</strong> Documento que certifica la capacitaci√≥n de un piloto.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/4446qs85e/aeronautica%20civil.png" alt="OACI" class="img-leccion"style="max-width:50%;">
    `
  },
  controles_y_maniobras: {
    nombre: "Controles y maniobras ",
    descripcion: "Aprende a manejar los controles del avi√≥n y a realizar maniobras b√°sicas de vuelo.",
    contenido: `
      <ul class="lista-leccion">
        <li><strong>Elevadores:</strong> Controlan la altitud y el movimiento de cabeceo.</li>
        <li><strong>Alerones:</strong> Permiten girar el avi√≥n hacia la izquierda o derecha.</li>
        <li><strong>Tim√≥n de direcci√≥n:</strong> Controla el movimiento lateral (gui√±ada).</li>
        <li><strong>Flaps:</strong> Incrementan la sustentaci√≥n durante el despegue y aterrizaje.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/4446qs85e/CessnaTroisAxesEsp.png" alt="Controles de vuelo" class="img-leccion">
    `
  },
  navegacion_aerea: {
    nombre: "Navegaci√≥n a√©rea ",
    descripcion: "Descubre c√≥mo los pilotos determinan su posici√≥n y rumbo en el espacio a√©reo.",
    contenido: `
      <p>La navegaci√≥n a√©rea se basa en instrumentos, coordenadas y se√±ales de radio para ubicar y guiar una aeronave.</p>
      <ul class="lista-leccion">
        <li><strong>GPS:</strong> Sistema satelital que ofrece posicionamiento global.</li>
        <li><strong>VOR:</strong> Sistema de navegaci√≥n basado en radiofrecuencia.</li>
        <li><strong>Indicador de rumbo:</strong> Muestra la direcci√≥n del avi√≥n respecto al norte.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/4446qs85e/avion2.png" alt="Carta de navegaci√≥n" class="img-leccion">
    `
  },
  procedimientos_de_emergencia: {
    nombre: "Procedimientos de emergencia ",
    descripcion: "Conoce las acciones que se deben seguir ante fallos o situaciones cr√≠ticas en vuelo.",
    contenido: `
      <p>Los pilotos deben estar entrenados para actuar de forma r√°pida y segura durante una emergencia.</p>
      <ul class="lista-leccion">
        <li><strong>P√©rdida de motor:</strong> Mantener velocidad de planeo y buscar zona de aterrizaje.</li>
        <li><strong>Comunicaci√≥n:</strong> Usar la radio de emergencia para avisar a control.</li>
        <li><strong>Fuego a bordo:</strong> Identificar el origen y aplicar procedimientos de extinci√≥n.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/4446qs85e/pngtree-emergency-plan-documents-in-paper-binder-vector-png-image_6635970.png" alt="Emergencia a√©rea" class="img-leccion"style="max-width:50%;">
    `
  },
  seguridad_aerea: {
    nombre: "Seguridad a√©rea ",
    descripcion: "Aprende los principios y sistemas que protegen la operaci√≥n a√©rea.",
    contenido: `
      <p>La seguridad a√©rea busca prevenir accidentes mediante protocolos, formaci√≥n y tecnolog√≠a.</p>
      <ul class="lista-leccion">
        <li><strong>CRM (Crew Resource Management):</strong> Coordinaci√≥n efectiva entre los miembros de la tripulaci√≥n.</li>
        <li><strong>Mantenimiento preventivo:</strong> Asegura que los equipos funcionen correctamente.</li>
        <li><strong>Investigaci√≥n de accidentes:</strong> Permite aprender de los errores para evitarlos.</li>
        <li><strong>Organismos:</strong> La NTSB investiga accidentes; la OACI establece est√°ndares globales.</li>
      </ul>
      <img src="https://uploads.onecompiler.io/43d6bw78q/4446qs85e/png-clipart-computer-icons-theme-security-miscellaneous-blue.png" alt="Seguridad a√©rea" class="img-leccion"style="max-width:50%;">
    `
  }
};

  // Mostrar t√≠tulo y descripci√≥n del tema
  const info = temasInfo[tema] || { 
    nombre: "Lecci√≥n de aviaci√≥n", 
    descripcion: "Explora este tema antes de comenzar." 
  };
  tituloLeccion.textContent = info.nombre;
  document.getElementById("descripcionLeccion").textContent = info.descripcion;

 // Cargar la introducci√≥n desde preguntas.json si existe
fetch('preguntas.json')
  .then(res => res.json())
  .then(datos => {
    const temaSeguro = (tema || "").toLowerCase();
    const nivel = datos.niveles.find(n => n.titulo.toLowerCase().includes(temaSeguro));
    if (nivel && nivel.introduccion) {
      document.getElementById("contenidoLeccion").innerHTML = `<p>${nivel.introduccion}</p>`;
    } else {
      document.getElementById("contenidoLeccion").innerHTML = info.contenido || "<p>Material introductorio no disponible.</p>";
    }
  })
  .catch(() => {
    document.getElementById("contenidoLeccion").innerHTML = info.contenido || "<p>Material introductorio no disponible.</p>";
  });

  // üîπ Cargar preguntas desde el archivo JSON
async function cargarPreguntas() {
  try {
    const respuesta = await fetch('preguntas.json');
    const datos = await respuesta.json();

    const temaSeguro = (tema || "").toLowerCase(); // evita errores si tema es null

   function normalizar(texto) {
  return texto
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // elimina tildes
    .replace(/ /g, "_"); // reemplaza espacios por _
}

const nivel = datos.niveles.find(n =>
  normalizar(n.titulo).includes(normalizar(temaSeguro))
);

    if (nivel) {
      preguntas = nivel.preguntas;
      tituloLeccion.textContent = nivel.titulo;
      mostrarPregunta();
    } else {
      contenedorPreguntas.innerHTML = `
        <p>‚ö†Ô∏è No se encontr√≥ la lecci√≥n correspondiente a este tema.</p>
        <button class="btn-principal" onclick="window.location.href='niveles.html'">Volver a niveles</button>
      `;
      console.warn(`Tema '${tema}' no encontrado en preguntas.json`);
    }
  } catch (error) {
    contenedorPreguntas.innerHTML = "<p>Error al cargar las preguntas üò¢</p>";
    console.error(error);
  }
}

  // üîπ Mostrar una pregunta
  function mostrarPregunta() {
    const pregunta = preguntas[indiceActual];
    contenedorPreguntas.innerHTML = `
      <h3>${pregunta.pregunta}</h3>
      <div class="opciones">
        ${pregunta.opciones.map(op => `<button class="opcion">${op}</button>`).join('')}
      </div>
    `;
    document.querySelectorAll('.opcion').forEach(btn => {
      btn.addEventListener('click', () => verificarRespuesta(btn.textContent));
    });
  }

  // üîπ Verificar respuesta
  function verificarRespuesta(respuestaSeleccionada) {
    const pregunta = preguntas[indiceActual];
    const botones = document.querySelectorAll('.opcion');
    const sonidoCorrecto = document.getElementById('sonidoCorrecto');
    const sonidoIncorrecto = document.getElementById('sonidoIncorrecto');

    botones.forEach(boton => {
      boton.disabled = true;
      if (boton.textContent === pregunta.respuesta) {
        boton.classList.add('correcta');
      } else if (boton.textContent === respuestaSeleccionada) {
        boton.classList.add('incorrecta');
      }
    });

    if (respuestaSeleccionada === pregunta.respuesta) {
      puntaje++;
      sonidoCorrecto.currentTime = 0;
      sonidoCorrecto.play();
      lanzarConfeti();
    } else {
      sonidoIncorrecto.currentTime = 0;
      sonidoIncorrecto.play();
      if (window.navigator.vibrate) window.navigator.vibrate(200);
    }

    btnSiguiente.style.display = 'block';
  }

  // üîπ Bot√≥n siguiente
  btnSiguiente.addEventListener('click', () => {
    indiceActual++;
    if (indiceActual < preguntas.length) {
      btnSiguiente.style.display = 'none';
      mostrarPregunta();
    } else {
      finalizarLeccion();
    }
  });

 function finalizarLeccion() {
  contenedorPreguntas.innerHTML = `
    <h3>‚úÖ ¬°Lecci√≥n completada!</h3>
    <p>Tu puntuaci√≥n: ${puntaje} / ${preguntas.length}</p>
    <button class="btn-principal" onclick="window.location.href='niveles.html'">Volver a niveles</button>
  `;
  btnSiguiente.style.display = 'none';

  // üéØ Actualizar puntos totales
  let puntosTotales = parseInt(localStorage.getItem('totalPuntos') || '0');
  puntosTotales += puntaje * 10;
  localStorage.setItem('totalPuntos', puntosTotales);

  // üèÜ Actualizar progreso (desbloquear siguiente nivel)
  const nivelActual = parseInt(localStorage.getItem('nivelActual') || '1');
  let progreso = parseInt(localStorage.getItem('progreso') || '1');

  if (nivelActual >= progreso) {
    localStorage.setItem('progreso', nivelActual + 1);
  }

  // üî• Guardar fecha de √∫ltima lecci√≥n para la racha
  const hoy = new Date().toDateString();
  localStorage.setItem('ultimaFecha', hoy);
}

  // üîπ Efecto confeti
  function lanzarConfeti() {
    const cantidad = 30;
    for (let i = 0; i < cantidad; i++) {
      const confeti = document.createElement("div");
      confeti.classList.add("confeti");
      confeti.style.left = Math.random() * 100 + "vw";
      confeti.style.backgroundColor = ["#4CAF50", "#81C784", "#A5D6A7"][Math.floor(Math.random() * 3)];
      document.body.appendChild(confeti);
      setTimeout(() => confeti.remove(), 3000);
    }
  }

  // üîπ Mostrar preguntas al pulsar "Comenzar"
  btnComenzar.addEventListener("click", () => {
    introLeccion.style.display = "none";
    contenedorPreguntas.style.display = "block";
    cargarPreguntas();
  });

  // üéôÔ∏è Narrador de contenido educativo
const btnNarrar = document.getElementById("btnNarrar");

if (btnNarrar) {
  btnNarrar.addEventListener("click", () => {
    const texto = `${info.nombre}. ${info.descripcion.replace(/<[^>]+>/g, "")}`;
    narrarTexto(texto);
  });
}

function narrarTexto(texto) {
  if (!window.speechSynthesis) {
    alert("‚ö†Ô∏è Tu navegador no soporta narraci√≥n de voz.");
    return;
  }

  // Detiene cualquier narraci√≥n anterior
  window.speechSynthesis.cancel();

  const mensaje = new SpeechSynthesisUtterance(texto);
  mensaje.lang = "es-ES"; // espa√±ol
  mensaje.pitch = 1;
  mensaje.rate = 1; // velocidad
  mensaje.volume = 1;

  // Intenta elegir una voz en espa√±ol si est√° disponible
  const voces = window.speechSynthesis.getVoices();
  const vozEspanol = voces.find(v => v.lang.startsWith("es"));
  if (vozEspanol) mensaje.voice = vozEspanol;

  window.speechSynthesis.speak(mensaje);
}

</script>
  <audio id="sonidoCorrecto" preload="auto">
  <source src="Audio/Correct sound.mp3" type="audio/mp3">
</audio>
<audio id="sonidoIncorrecto" preload="auto">
  <source src="Audio/invalid-selection-39351.mp3" type="audio/mp3">
</audio>
</body>
</html>